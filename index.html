<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Maturity Assessment</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Fallback if Chart.js fails to load
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js failed to load from CDN. Radar chart will not be available.');
                // Hide chart container if Chart.js is not available
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.innerHTML = '<p class="alert alert-warning">Chart visualization unavailable. Chart.js library could not be loaded.</p>';
                }
            }
        });
    </script>
</head>
<body>
    <!-- Preview Banner -->
    <div id="preview-banner" style="display: none; position: fixed; top: 0; left: 0; right: 0; z-index: 9999; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
      <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 20px; gap: 12px;">
        <div style="font-size: 24px; flex-shrink: 0;">ðŸ”¬</div>
        <div style="flex: 1; color: white;">
          <strong style="display: block; font-size: 14px;">Preview Environment</strong>
          <span style="display: block; font-size: 12px; opacity: 0.9;">This is not the official site - Test environment only</span>
        </div>
        <a id="preview-banner-pr-link" href="#" style="display: none; background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s ease; flex-shrink: 0; align-items: center; gap: 6px; text-decoration: none;" target="_blank" rel="noopener noreferrer">
          ðŸ’¬ Give feedback on the PR
        </a>
        <button id="preview-banner-close" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 50%; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s ease; flex-shrink: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;" aria-label="Close">âœ•</button>
      </div>
    </div>
    
    <div class="container">
        <header>
            <h1>ðŸŽ¯ Test Maturity Assessment</h1>
            <p class="subtitle">Evaluate and track testing maturity across teams and applications</p>
        </header>

        <nav class="tabs">
            <button class="tab-button active" data-tab="setup">Setup</button>
            <button class="tab-button" data-tab="interview">Interview</button>
            <button class="tab-button" data-tab="results">Results</button>
        </nav>

        <!-- Setup Tab -->
        <div id="setup" class="tab-content active">
            <div class="card">
                <h2>Application/Team Setup</h2>
                <div class="form-group">
                    <label for="app-name">Application/Team Name:</label>
                    <input type="text" id="app-name" placeholder="Enter application or team name">
                </div>
                <div class="form-group">
                    <label for="profile-select">Profile:</label>
                    <select id="profile-select">
                        <option value="">Select a profile...</option>
                        <option value="developer">Developer</option>
                        <option value="qa">QA Engineer</option>
                        <option value="devops">DevOps</option>
                        <option value="manager">Manager</option>
                        <option value="all">All Profiles</option>
                    </select>
                </div>
                <button id="start-interview" class="btn btn-primary">Start Interview</button>
            </div>

            <div class="card">
                <h2>Data Management</h2>
                <div class="data-actions">
                    <button id="export-data" class="btn btn-secondary">ðŸ“¥ Export Data</button>
                    <button id="import-data" class="btn btn-secondary">ðŸ“¤ Import Data</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                </div>
                <div id="saved-assessments"></div>
            </div>
        </div>

        <!-- Interview Tab -->
        <div id="interview" class="tab-content">
            <div class="card">
                <div class="interview-header">
                    <h2 id="interview-title">Interview Questions</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                        <span class="progress-text" id="progress-text">0 / 0</span>
                    </div>
                </div>
                
                <div id="questions-container"></div>
                
                <div class="interview-actions">
                    <button id="save-interview" class="btn btn-primary">ðŸ’¾ Save Assessment</button>
                    <button id="view-results" class="btn btn-secondary">ðŸ“Š View Results</button>
                </div>
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results" class="tab-content">
            <div class="card">
                <h2>Maturity Results</h2>
                <div class="form-group">
                    <label for="results-select">Select Assessment:</label>
                    <select id="results-select">
                        <option value="">Choose an assessment...</option>
                    </select>
                </div>
                <div id="results-container">
                    <div class="chart-container">
                        <canvas id="maturity-chart"></canvas>
                    </div>
                    <div id="theme-scores"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="questions.js"></script>
    <script src="app.js"></script>
    
    <!-- Preview Banner Script -->
    <script>
    (function() {
      // Show banner only on surge.sh or preview environments
      if (window.location.hostname.includes('surge.sh') || window.location.hostname.includes('preview')) {
        var banner = document.getElementById('preview-banner');
        var closeBtn = document.getElementById('preview-banner-close');
        var prLink = document.getElementById('preview-banner-pr-link');
        
        if (banner) {
          banner.style.display = 'block';
          document.body.style.paddingTop = '60px';
        }
        
        // Extract PR number from hostname (format: pr-[NUMBER]-test-maturity-preview.surge.sh)
        var hostname = window.location.hostname;
        var prMatch = hostname.match(/^pr-(\d+)-/);
        if (prMatch && prMatch[1] && prLink) {
          var prNumber = prMatch[1];
          // Validate PR number contains only digits (additional safety check)
          if (/^\d+$/.test(prNumber)) {
            prLink.href = 'https://github.com/sunix/test-maturity-interviews/pull/' + prNumber;
            prLink.style.display = 'inline-flex';
          }
        }
        
        if (closeBtn) {
          closeBtn.addEventListener('click', function() {
            if (banner) {
              banner.style.display = 'none';
              document.body.style.paddingTop = '0';
            }
          });
        }
        
        // Add hover effect to close button and link
        closeBtn.addEventListener('mouseenter', function() {
          this.style.background = 'rgba(255,255,255,0.35)';
        });
        closeBtn.addEventListener('mouseleave', function() {
          this.style.background = 'rgba(255,255,255,0.2)';
        });
        
        if (prLink) {
          prLink.addEventListener('mouseenter', function() {
            this.style.background = 'rgba(255,255,255,0.35)';
          });
          prLink.addEventListener('mouseleave', function() {
            this.style.background = 'rgba(255,255,255,0.2)';
          });
        }
      }
    })();
    </script>
</body>
</html>
